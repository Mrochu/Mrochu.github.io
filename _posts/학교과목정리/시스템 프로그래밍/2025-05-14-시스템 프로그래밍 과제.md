---
layout: post
title:  "시스템 프로그래밍 과제"
date:   2025-05-14 13:41:15 +0900
categories: [학교과목정리,시스템 프로그래밍]
---


1. 다음 데이터 파일을 읽고 학번과 평균을 출력하는 프로그램을 작성하시오. 데이터 입력은 저수준 파일 입출력을 이용하고, 형식 기반의 고수준 입출력을 사용할 때와 달리 추가로 필요한 작업은 무엇인지 적으시오. (30점) 
학번     철학 음악 미술	
2021001 98	99	97	
2021002 88	90	89	

```c++
//헤더 파일 불러옴
#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
//버퍼 사이즈 정의
#define BUFFER_SIZE 1024

int main(int argc, char *argv[]) {
    // 파일의 경로로 불러와서 쓰기에 도움말 추가
    // ./means ./problem1.dat 과 같은 형식으로 이용해야함
    if (argc != 2) {
        fprintf(stderr, "사용법: %s <파일 경로>\n", argv[0]);
        exit(EXIT_FAILURE);
    }
   //파일을 일기 전용으로 읽어들임
    int fd = open(argv[1], O_RDONLY);
    if (fd < 0) {
        perror("파일 열기 실패");
        exit(EXIT_FAILURE);
    }

    char buffer[BUFFER_SIZE + 1];
    ssize_t bytesRead;
    int bufPos = 0;
   //줄단위로 출력하도록 처리 만약 줄이 늘어나더라도 동일한 방식으로 처리 가능함
    while ((bytesRead = read(fd, buffer + bufPos, BUFFER_SIZE - bufPos)) > 0) {
        bufPos += bytesRead;
        buffer[bufPos] = '\0';  

        // 줄 단위로 분할
        char *line = strtok(buffer, "\n");
        while (line != NULL) {
            int id, phil, music, art;
            if (sscanf(line, "%d %d %d %d", &id, &phil, &music, &art) == 4) { // .dat 의 형식을 체크하고 출력하도록 함
                float avg = (phil + music + art) / 3.0; //평균냄
                printf("학번: %d, 평균: %.2f\n", id, avg);
            } else { // 숫자 4개가 뛰워져있는 형태가 아니라면 출력
                fprintf(stderr, "잘못된 줄 형식: %s\n", line);
            }
            line = strtok(NULL, "\n");
        }
    }
   //파일의 읽기 라인이 0 이하 즉 없으면 못읽어옴 따라서 안됨
    if (bytesRead < 0) {
        perror("파일 읽기 실패");
    }

    close(fd);
    return 0;
}
```

2. 날짜와 시간을 출력하는 명령 mydate를 작성하시오. 이때 mydate의 옵션은 다음과 같다. (30점)
   명령	   mydate
   옵션	   -a : 연, 월, 일, 요일, 시, 분, 초 출력       -y : 연도만 출력
	   -m : 월만 출력				-d : 일만 출력
	   -w : 요일만 출력				-h : 시. 분, 초 출력

```c++
#include <stdio.h>
#include <time.h>
#include <string.h>

int main(int argc, char *argv[]) {
    time_t now = time(NULL);
    struct tm *tm_info = localtime(&now);
    char buffer[64];

    if (argc == 1) {
        // 옵션 없으면 날짜 + 시간 출력
        strftime(buffer, sizeof(buffer), "%Y-%m-%d %H:%M:%S", tm_info);
        printf("%s\n", buffer);
    } 
    else if (argc == 2) { //보면 알수있듯 여러가지 정해준 옵션에 따라서 출력하도록 되어있음.
        if (strcmp(argv[1], "-y") == 0) { 
            strftime(buffer, sizeof(buffer), "%Y", tm_info);
        } else if (strcmp(argv[1], "-m") == 0) {
            strftime(buffer, sizeof(buffer), "%m", tm_info);
        } else if (strcmp(argv[1], "-d") == 0) {
            strftime(buffer, sizeof(buffer), "%d", tm_info);
        } else if (strcmp(argv[1], "-w") == 0) {
            strftime(buffer, sizeof(buffer), "%A", tm_info);  
        } else if (strcmp(argv[1], "-h") == 0) {
            strftime(buffer, sizeof(buffer), "%H:%M:%S", tm_info);
        } else if (strcmp(argv[1], "-a") == 0) {
            strftime(buffer, sizeof(buffer), "%Y-%m-%d %H:%M:%S", tm_info);
        } else { //만약 위의 옵션이 아닌 다른 옵션들을 사용할 경우에 뜨게되는 몹션 문제있음 설명하는 코드
            printf("Invalid option: %s\n", argv[1]);
            return 1;
        }
        printf("%s\n", buffer);
    } 
    else { //옵션이 2개 이상 즉 문제에서 요구한것 이상의 문제점임 실제로 코드를 짠다면 이러한 부분을 고려해서 나누어 놓고 처리하겠지만 문제에서 요구한 사항은 아니기에 안했음
        printf("opt problem\n");
        return 1;
    }

    return 0;
}
```

3. 1~100000까지 더하면서 결괏값을 반복적으로 출력하는 프로그램을 작성하고, 이 프로그램의 전체 실행 시간, 사용자 모드 실행 시간, 시스템 모드 실행 시간을 측정하시오. (40점)


```c++
#include <stdio.h>
#include <sys/time.h>
#include <sys/resource.h>

int main() {
    struct timeval start_wall, end_wall;
    struct rusage usage;

    //시간 시작
    gettimeofday(&start_wall, NULL); 

   //값이 길기에 longlong써야함 안그러면 오버플로우 나서 값이 이상하게 나옴
    long long sum = 0;
    //함계산하는 코드 별거 없음
    for (int i = 1; i <= 100000; i++) {
        sum += i;
        if (i % 10000 == 0) {
            printf("현재 합 (i=%d): %lld\n", i, sum);
        }
    }

    // 시간 끝
    gettimeofday(&end_wall, NULL);

    // 리소스 사용량 
    getrusage(RUSAGE_SELF, &usage);
   //시간들 저장
    double total_time = (end_wall.tv_sec - start_wall.tv_sec) +
                        (end_wall.tv_usec - start_wall.tv_usec) / 1e6;

    double user_time = usage.ru_utime.tv_sec + usage.ru_utime.tv_usec / 1e6;
    double sys_time  = usage.ru_stime.tv_sec + usage.ru_stime.tv_usec / 1e6;
   //시간들 출력.
    printf("\n총합: %lld\n", sum);
    printf("실행 시간 (wall-clock): %.6f초\n", total_time);
    printf("사용자 모드 시간: %.6f초\n", user_time);
    printf("시스템 모드 시간: %.6f초\n", sys_time);

    return 0;
}
// 1씩 출력하는건 너무 더러워서 조금 바꿈 1씩 출력하면 솔찍히 프린트하는데 시간이 더걸리겠다.

```

